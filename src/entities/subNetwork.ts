import { isHexString } from "ethers";
import { BaseEntity } from "./base";
import { Utils } from "../helper";

type AddressString = string;
type HexString = string;

export interface ISubNetwork {
  // Primary
  id?: string; // id generated by node
  ref?: string; // optional custom reference
  n: string; // name
  hand: string; // handle
  pTH?: string; // parent handle hash
  desc?: string; // description
  sC?: number; // subscription count
  acct?: AddressString; // owner of subNetwork
  ts?: number; // timestamp in millisec
  pub: boolean; // is public subNetwork
  rO: boolean;
  // sig?: HexString;
  // hash?: HexString;
}

export class SubNetwork extends BaseEntity {
  public id: string = "";
  public reference: string = "";
  public name: string = "";
  public handle: string = "";
  public description: string = "";
  public parentSubNetworkHash: string = "";
  public subsriberCount: number = 0;
  public account: string = "";
  public timestamp: number = 0;
  public isPublic: boolean = false;
  public readOnly: boolean = false;

  /**
   * @override
   * @returns {ISubNetwork}
   */
  public asPayload(): ISubNetwork {
    return {
      id: this.id,
      ref: this.reference,
      n: this.name,
      hand: this.handle,
      pTH: this.parentSubNetworkHash, // parent handle hash
      desc: this.description, // description
      // sC: this.subsriberCount, // subscription count
      // acct: this.account, // owner of subNetwork
      // ts: this.timestamp, // timestamp in millisec
      pub: this.isPublic, // is public subNetwork
      rO: this.readOnly,
    };
  }

  /**
   * @override
   * @returns {Buffer}
   */
  public encodeBytes(): Buffer {
    return Utils.encodeBytes(
      { type: "string", value: this.id },
      { type: "string", value: this.reference },
      { type: "string", value: this.name },
      { type: "string", value: this.handle },
      { type: "string", value: this.description },
      // { type: "hex", value: this.parentSubNetworkHash },
      // { type: 'int', value: this.subsriberCount },
      { type: "boolean", value: this.isPublic },
      { type: "boolean", value: this.readOnly }
    );
  }
}
